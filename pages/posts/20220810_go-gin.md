---
title: go gin ğŸ“’
date: 2022-08-10
draft: true
type: GoLang
lang: zh
duration: 15min
---

## gin çš„å®‰è£…

[å®˜æ–¹æ–‡æ¡£](https://gin-gonic.com)

```bash
go get -u github.com/gin-gonic/gin
```

```go
package main

import (
  "net/http"
  "github.com/gin-gonic/gin"
)

func main() {
  router := gin.Default()
  router.GET("/ping", func(ctx *gin.Context) {
    ctx.JSON(http.StatusOK, gin.H{
      "message": "pong",
    })
  })
  router.Run()
}
```

## gin.Default() ä¸ gin.New()çš„åŒºåˆ«

gin.Default é»˜è®¤å¼€å¯æ—¥å¿—ï¼ˆLoggerï¼‰å’Œæ•…éšœæ¢å¤ï¼ˆRecoveryï¼‰

## è·¯ç”±åˆ†ç»„

```go
	router := gin.Default()
	goods := router.Group("/goods")
	goods.GET("/list", goodlist)
	goods.GET("/detail/:id", goodDetail)
	goods.POST("/add", createGood)


func goodDetail(c *gin.Context) {
  id := c.Param("id")
}
```

## éªŒè¯è·¯ç”±å‚æ•°

```go
type Person struct {
	ID   string `uri:"id" binding:"required,uuid"`
	Name string `uri:"name" binding:"required"`
}

	router.GET("/user/:name/:id", func(c *gin.Context) {
		var person Person

		if err := c.ShouldBindUri(&person); err != nil {
			c.Status(404)
			return
		}
		c.JSON(http.StatusOK, gin.H{
			"name": person.Name,
			"id":   person.ID,
		})
	})
```

## è·å– Query å‚æ•°

```go
		lang := c.Query("lang") // æ— é»˜è®¤å€¼
		age := c.DefaultQuery("age", "0") // æœ‰é»˜è®¤å€¼
```

## è·å–è¯·æ±‚ä½“

```go
		c.PostForm("message") // æ— é»˜è®¤å€¼
		c.DefaultPostForm("nike", "") // æœ‰é»˜è®¤å€¼
    c.PostFormMap("user") // è·å–ä¸€ä¸ªmapå¯¹è±¡
		c.PostFormArray("item") // è·å–ä¸€ä¸ª Array

```

## å­—æ®µéªŒè¯

[å®˜æ–¹æ–‡æ¡£](https://pkg.go.dev/github.com/go-playground/validator/v10)

```go
type SignUpForm struct {
	Age        uint8  `json:"age" binding:"gte=1,lte=130"`
	Name       string `json:"name" binding:"required,min=3"`
	Email      string `json:"email" binding:"required,email"`
	Password   string `json:"password" binding:"required"`
	RePassword string `json:"re_password" binding:"required,eqfield=Password"` //è·¨å­—æ®µ
}

router.POST("/signup", func(c *gin.Context) {
		var signUpFrom SignUpForm
		if err := c.ShouldBind(&signUpFrom); err != nil {
			c.JSON(http.StatusBadRequest, gin.H{
				"error": err.Error(),
			})
			return
		}

		c.JSON(http.StatusOK, gin.H{
			"msg": "æ³¨å†ŒæˆåŠŸ",
		})
	})
```

## è¡¨å•éªŒè¯é”™è¯¯ç¿»è¯‘ä¸­æ–‡

```go
func InitTrans(locale string) (err error) {
	//ä¿®æ”¹ginæ¡†æ¶ä¸­çš„validatorå¼•æ“å±æ€§, å®ç°å®šåˆ¶
	if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
		//æ³¨å†Œä¸€ä¸ªè·å–jsonçš„tagçš„è‡ªå®šä¹‰æ–¹æ³•
		v.RegisterTagNameFunc(func(fld reflect.StructField) string {
			name := strings.SplitN(fld.Tag.Get("json"), ",", 2)[0]
			if name == "-" {
				return ""
			}
			return name
		})

		zhT := zh.New() //ä¸­æ–‡ç¿»è¯‘å™¨
		enT := en.New() //è‹±æ–‡ç¿»è¯‘å™¨
		//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¤‡ç”¨çš„è¯­è¨€ç¯å¢ƒï¼Œåé¢çš„å‚æ•°æ˜¯åº”è¯¥æ”¯æŒçš„è¯­è¨€ç¯å¢ƒ
		uni := ut.New(enT, zhT, enT)
		trans, ok = uni.GetTranslator(locale)
		if !ok {
			return fmt.Errorf("uni.GetTranslator(%s)", locale)
		}

		switch locale {
		case "en":
			en_translations.RegisterDefaultTranslations(v, trans)
		case "zh":
			zh_translations.RegisterDefaultTranslations(v, trans)
		default:
			en_translations.RegisterDefaultTranslations(v, trans)
		}
		return
	}

	return
}

func main() {
	//ä»£ç ä¾µå…¥æ€§å¾ˆå¼º ä¸­é—´ä»¶
	if err := InitTrans("zh"); err != nil {
		fmt.Println("åˆå§‹åŒ–ç¿»è¯‘å™¨é”™è¯¯")
		return
	}
}
```

## gin ä¼˜é›…çš„é€€å‡º

[å®˜æ–¹æ–‡æ¡£](https://gin-gonic.com/zh-cn/docs/examples/graceful-restart-or-stop/)
å¾®æœåŠ¡ å¯åŠ¨ä¹‹å‰æˆ–è€…å¯åŠ¨ä¹‹åä¼šåšä¸€ä»¶äº‹ï¼šå°‡å½“å‰çš„æœåŠ¡çš„ ip åœ°å€å’Œç«¯å£å·æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘ä»¬å½“å‰çš„æœåŠ¡åœæ­¢äº†ä»¥åå¹¶æ²¡æœ‰å‘ŠçŸ¥æ³¨å†Œä¸­å¿ƒï¼Œ

```go
func main() {
	router := gin.Default()
	router.GET("/", func(c *gin.Context) {
		time.Sleep(5 * time.Second)
		c.String(http.StatusOK, "Welcome Gin Server")
	})

	go func() {
	  router.Run()
	}()

	// ç­‰å¾…ä¸­æ–­ä¿¡å·ä»¥ä¼˜é›…åœ°å…³é—­æœåŠ¡å™¨ï¼ˆè®¾ç½® 5 ç§’çš„è¶…æ—¶æ—¶é—´ï¼‰
	quit := make(chan os.Signal)
	signal.Notify(quit, os.Interrupt)
	<-quit
	log.Println("Shutdown Server ...")
}
```
